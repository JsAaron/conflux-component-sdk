!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).CfxWeb3=e()}(this,(function(){"use strict";const t=function(){};t.create=function(){return window.Android?(this.exist=!0,this.getLocale=function(){return window.Android.getLocale()},this.setConfig=function(t){this._confData=t},this.requestUserInfo=function(t){return window.Android.requestUserInfo(JSON.stringify(t))},this.setNavList=function(t){return window.Android.setNavList(JSON.stringify(t))},this.setMenuList=function(t){return window.Android.setMenuList(JSON.stringify(t))},this.setAppConfig=function(t){return window.Android.setAppConfig(JSON.stringify(t))},this.prompt=function(t){return window.Android.prompt(JSON.stringify(t))},this.alert=function(t){return window.Android.alert(JSON.stringify(t))},this.showNav=function(t){return window.Android.showNav(JSON.stringify(t))},this.signData=function(t){return window.Android.signData(JSON.stringify(t))},this.showTitle=function(t){return window.Android.showTitle(JSON.stringify(t))},this.setTitle=function(t){return window.Android.setTitle(JSON.stringify(t))},this.setTitleList=function(t){return window.Android.setTitleList(JSON.stringify(t))},this.input=function(t){return window.Android.input(JSON.stringify(t))},this.confirm=function(t){return window.Android.confirm(JSON.stringify(t))},this.step=function(t){return window.Android.step(JSON.stringify(t))},this.slide=function(t){return window.Android.slide(JSON.stringify(t))},this.datetimePick=function(t){return window.Android.datetimePick(JSON.stringify(t))},this.contractCall=function(t){return window.Android.contractCall(JSON.stringify(t))},this.accountCall=function(t){return window.Android.accountCall(JSON.stringify(t))},this.getTransactionByHash=function(t){return window.Android.getTransactionByHash(JSON.stringify(t))},this.deployContract=function(t){return window.Android.deployContract(JSON.stringify(t))},this.toShare=function(t){return window.Android.toShare(JSON.stringify(t))},this.showScan=function(t){return window.Android.showScan(JSON.stringify(t))},this.setRealName=function(t){return window.Android.setRealName(JSON.stringify(t))},this.exitDapp=function(t){return window.Android.exitDapp(JSON.stringify(t))},this.requestWalletInfo=function(t){return window.Android.requestWalletInfo(JSON.stringify(t))},this.requestRealName=function(t){return window.Android.requestRealName(JSON.stringify(t))},this.initDapp=function(t){return window.Android.initDapp(JSON.stringify(t))},this.getShareInfo=function(){return JSON.stringify(this._shareInfo)},this.setShareInfo=function(t){this._shareInfo=t},this.getLoginToken=function(t){return window.Android.getLoginToken(t)},this.setLoginToken=function(t){return window.Android.setLoginToken(JSON.stringify(t))},this.requestToNewWeb=function(t){return window.Android.requestToNewWeb(JSON.stringify(t))},this.transferNft=function(t){return window.Android.transferNft(JSON.stringify(t))},this.launchWXMiniPay=function(t){return window.Android.launchWXMiniPay(JSON.stringify(t))}):this.exist=!1,this.exist};const e=function(){};e.create=function(){return window.webkit&&window.webkit.messageHandlers?(this.exist=!0,this.getLocale=function(){return window.webkit.messageHandlers.getLocale.postMessage({})},this.setConfig=function(t){this._confData=t},this.requestUserInfo=function(t){return window.webkit.messageHandlers.requestUserInfo.postMessage(t)},this.setNavList=function(t){return window.webkit.messageHandlers.setNavList.postMessage(t)},this.setMenuList=function(t){return window.webkit.messageHandlers.setMenuList.postMessage(t)},this.setAppConfig=function(t){return window.webkit.messageHandlers.setAppConfig.postMessage(t)},this.prompt=function(t){return window.webkit.messageHandlers.prompt.postMessage(t)},this.alert=function(t){return window.webkit.messageHandlers.alert.postMessage(t)},this.showNav=function(t){return window.webkit.messageHandlers.showNav.postMessage(t)},this.signData=function(t){return window.webkit.messageHandlers.signData.postMessage(t)},this.showTitle=function(t){return window.webkit.messageHandlers.showTitle.postMessage(t)},this.setTitle=function(t){return window.webkit.messageHandlers.setTitle.postMessage(t)},this.setTitleList=function(t){return window.webkit.messageHandlers.setTitleList.postMessage(t)},this.input=function(t){return window.webkit.messageHandlers.input.postMessage(t)},this.confirm=function(t){return window.webkit.messageHandlers.confirm.postMessage(t)},this.step=function(t){return window.webkit.messageHandlers.step.postMessage(t)},this.slide=function(t){return window.webkit.messageHandlers.slide.postMessage(t)},this.datetimePick=function(t){return window.webkit.messageHandlers.datetimePick.postMessage(t)},this.contractCall=function(t){return window.webkit.messageHandlers.contractCall.postMessage(t)},this.accountCall=function(t){return window.webkit.messageHandlers.accountCall.postMessage(t)},this.getTransactionByHash=function(t){return window.webkit.messageHandlers.getTransactionByHash.postMessage(t)},this.deployContract=function(t){return window.webkit.messageHandlers.deployContract.postMessage(t)},this.toShare=function(t){return window.webkit.messageHandlers.toShare.postMessage(t)},this.showScan=function(t){return window.webkit.messageHandlers.showScan.postMessage(t)},this.setRealName=function(t){return window.webkit.messageHandlers.setRealName.postMessage(t)},this.requestWalletInfo=function(t){return window.webkit.messageHandlers.requestWalletInfo.postMessage(t)},this.exitDapp=function(t){return window.webkit.messageHandlers.exitDapp.postMessage(t)},this.requestRealName=function(t){return window.webkit.messageHandlers.requestRealName.postMessage(t)},this.initDapp=function(t){return window.webkit.messageHandlers.initDapp.postMessage(t)},this.getShareInfo=function(){return this._shareInfo},this.setShareInfo=function(t){this._shareInfo=t},this.getLoginToken=function(t){return window.webkit.messageHandlers.getLoginToken.postMessage(t)},this.setLoginToken=function(t){return window.webkit.messageHandlers.setLoginToken.postMessage(t)},this.requestToNewWeb=function(t){return window.webkit.messageHandlers.requestToNewWeb.postMessage(t)},this.transferNft=function(t){return window.webkit.messageHandlers.transferNft.postMessage(t)},this.launchWXMiniPay=function(t){return window.webkit.messageHandlers.launchWXMiniPay.postMessage(t)}):this.exist=!1,this.exist};const n=function(){};function i(t){this._callBackMap={},this.platform=this.getPlatform(),this.initProvider(),this.initWatch(),this.setConfig(t)}return n.create=function(){return this.setConfig=function(t){this._confData=t,window.CfxWeb3UI?this._web3UI=new CfxWeb3UI(t):this._web3UI=null},this.getLocale=function(){return"getLocale cn"},this.requestUserInfo=function(t){return this._web3UI&&this._web3UI.reqUserInfo(t),"requestUserInfo:"+JSON.stringify(t)},this.setNavList=function(t){return"setNavList:"+JSON.stringify(t)},this.setMenuList=function(t){return"setMenuList:"+JSON.stringify(t)},this.setAppConfig=function(t){return"setAppConfig:"+JSON.stringify(t)},this.getShareInfo=function(){return this._shareInfo},this.setShareInfo=function(t){this._shareInfo=t},this.prompt=function(t){return this._web3UI&&this._web3UI.prompt(t),"prompt:"+JSON.stringify(t)},this.input=function(t){return this._web3UI&&this._web3UI.input(t),"input:"+JSON.stringify(t)},this.confirm=function(t){return this._web3UI&&this._web3UI.confirm(t),"confirm:"+JSON.stringify(t)},this.step=function(t){return this._web3UI&&this._web3UI.step(t),"step:"+JSON.stringify(t)},this.slide=function(t){return this._web3UI&&this._web3UI.slide(t),"slide:"+JSON.stringify(t)},this.datetimePick=function(t){return this._web3UI&&this._web3UI.datetimePick(t),"datetimePick:"+JSON.stringify(t)},this.alert=function(t){return this._web3UI&&this._web3UI.alert(t),"alert:"+JSON.stringify(t)},this.showNav=function(t){return"showNav:"+JSON.stringify(t)},this.signData=function(t){return"signData:"+JSON.stringify(t)},this.showTitle=function(t){return"showTitle:"+JSON.stringify(t)},this.setTitle=function(t){return"setTitle:"+JSON.stringify(t)},this.setTitleList=function(t){return"setTitleList:"+JSON.stringify(t)},this.contractCall=function(t){return""},this.accountCall=function(t){return this._web3UI&&this._web3UI.accountCall(t),""},this.getTransactionByHash=function(t){return this._web3UI&&this._web3UI.getTransactionByHash(t),""},this.deployContract=function(t){return this._web3UI&&this._web3UI.deployContract(t),""},this.toShare=function(t){return""},this.showScan=function(t){return""},this.setRealName=function(t){return""},this.setLoginToken=function(t){return""},this.requestWalletInfo=function(t){return""},this.exitDapp=function(t){return window.close(),""},this.initDapp=function(t){return""},this.requestToNewWeb=function(t){return""},this.transferNft=function(t){return""},this.launchWXMiniPay=function(t){return""},this.exist=!1,this.exist},i.createApp=function(t){let e=new i(t);return e.init(),e},i.prototype.initWatch=function(){var t=this;window.getShareInfo=function(){return t.provider.getShareInfo()}},i.prototype.initProvider=function(){let i=-1!=document.cookie.indexOf("isInConfluxOs=true");"ios"==this.platform&&e.create()&&i?this.provider=e:"android"==this.platform&&t.create()&&i?this.provider=t:(n.create(),this.provider=n)},i.prototype.setConfig=function(t){this._confData=t,this._appInfo=t.appInfo,this.provider.setConfig(t),this.provider.setAppConfig(t.appConf),this.provider.initDapp(this._appInfo)},i.prototype.init=function(){this.setMenuList(this._confData.menuList),this.setShareInfo(this._confData.shareInfo),this.setNavList(this._confData.navList),this._confData.showNav&&this.showNav(1)},i.prototype.isObject=function(t){return"[object Object]"===Object.prototype.toString.call(t)},i.prototype.isInConfluxOs=function(){var t=document.cookie;return this.provider&&this.provider.exist&&-1!=t.indexOf("isInConfluxOs=true")},i.prototype.setCallBack=function(t,e,n){var i={callBack:e,target:n,backName:t},s=this;window[t]=function(t){try{i.callBack.apply(i.target,[t])}catch(e){s.errorLog(i.backName,"setCallBack",t)}}},i.prototype.onNullCallBack=function(){},i.prototype.setAppInfo=function(t){this._appInfo=t},i.prototype.getShareInfo=function(){return this._shareInfo},i.prototype.setShareInfo=function(t){this._shareInfo=t;try{this.provider.setShareInfo(t)}catch(t){this.errorLog("CfxWeb3","setShareInfo",t.message)}},i.prototype.prompt=function(t,e,n,i,s,r,o){null!=e?this.setCallBack("__onPrompt__",e,n):this.setCallBack("__onPrompt__",this.onNullCallBack,this);var a={icon:r,title:o,description:t,rule:i,tip:s,cancelTxt:"取消",sureTxt:"确定",callBack:"__onPrompt__"};this.promptInfo(a)},i.prototype.promptInfo=function(t){this.provider.prompt(t)},i.prototype.alertInfo=function(t){this.provider.alert(t)},i.prototype.showNav=function(t){this.provider.showNav({flag:t?1:0})},i.prototype.input=function(t,e,n,i,s,r){return null!=e?this.setCallBack("__onInput__",e,n):this.setCallBack("__onInput__",this.onNullCallBack,this),this.inputInfo({icon:s,title:r,description:t,length:i,callBack:"__onInput__"})},i.prototype.inputInfo=function(t){return this.provider.input(t)},i.prototype.confirmInfo=function(t){return console.log("🚀 ~ file: index.js:172 ~ jsonObj:",t),this.provider.confirm(t)},i.prototype.step=function(t,e,n,i,s,r,o,a,c){return null!=s?this.setCallBack("__onStep__",s,r):this.setCallBack("__onStep__",this.onNullCallBack,this),this.stepInfo({icon:a,title:c,description:o,min:t,max:e,value:i,step:n,callBack:"__onStep__"})},i.prototype.stepInfo=function(t){return this.provider.step(t)},i.prototype.slide=function(t,e,n,i,s,r,o,a,c){return null!=i?this.setCallBack("__onSlide__",i,s):this.setCallBack("__onSlide__",this.onNullCallBack,this),this.slideInfo({icon:a,title:c,sicon:o,description:r,min:t,max:e,value:n,callBack:"__onSlide__"})},i.prototype.slideInfo=function(t){return this.provider.slide(t)},i.prototype.datetimePick=function(t,e,n,i,s,r){return null!=e?this.setCallBack("__onDateTimePick__",e,n):this.setCallBack("__onDateTimePick__",this.onNullCallBack,this),this.datetimePickInfo({icon:s,title:r,description:i,datatime:t,callBack:"__onDateTimePick__"})},i.prototype.datetimePickInfo=function(t){return this.provider.datetimePick(t)},i.prototype.getPlatform=function(){var t="pc";return/(iPhone|iPad|iPod|iOS)/i.test(navigator.userAgent)?t="ios":/(Android)/i.test(navigator.userAgent)?t="android":/(Windows Phone)/i.test(navigator.userAgent)&&(t="windowsPhone"),t},i.prototype.getLocale=function(){for(var t=document.cookie.split(";"),e=0;e<t.length;e++){var n=t[e].split("=");if("osLocale"==n[0])return n[1]}return"unKnow"},i.prototype.reqUserInfo=function(t,e,n,i,s){var r=this,o={};if(window._requestUserInfoCallBack_=function(t){r.onUserInfo(t)},this.isObject(t)){var a=t,c=a.data;this._callBack=a.callBack,this._callContext=a.context,o={chainCode:c.chainCode,needRealNameAuth:c.realAuth,needLoginAuth:c.loginAuth,refresh:c.refresh,callBack:"_requestUserInfoCallBack_"}}else this._callBack=i,this._callContext=s,o={chainCode:t,needRealNameAuth:e,refresh:n,callBack:"_requestUserInfoCallBack_"};try{return this.provider.requestUserInfo(o)}catch(t){this.errorLog("CfxWeb3","reqUserInfo",{paras:o,errMsg:t.message})}},i.prototype.onUserInfo=function(t){try{0==t.code&&(this._userInfo=t.data,this.logoSrc="data:image/jpeg;base64,"+t.data.userImageFileBase64),null!=this._callBack&&this._callBack.apply(this._callContext,[t])}catch(t){this.errorLog("CfxWeb3","onUserInfo",{errMsg:t.message})}},i.prototype.getUserInfo=function(){return this._userInfo},i.prototype.setMenuList=function(t){try{return this.provider.setMenuList(t)}catch(e){this.errorLog("CfxWeb3","setMenuList",{paras:t,errMsg:e.message})}},i.prototype.setNavList=function(t){try{return this.provider.setNavList(t)}catch(e){this.errorLog("CfxWeb3","setNavList",{paras:t,errMsg:e.message})}},i.prototype.showTitle=function(t){try{return this.provider.showTitle(t)}catch(e){this.errorLog("CfxWeb3","showTitle",{paras:t,errMsg:e.message})}},i.prototype.setTitle=function(t){try{return this.provider.setTitle(t)}catch(e){this.errorLog("CfxWeb3","setTitle",{paras:t,errMsg:e.message})}},i.prototype.setTitleList=function(t){try{return this.provider.setTitleList(t)}catch(e){this.errorLog("CfxWeb3","setTitleList",{paras:t,errMsg:e.message})}},i.prototype.cloneTo=function(t,e){for(var n in t)e[n]=t[n];return e},i.prototype.createMenuInfo=function(t,e,n){return{icon:t,menuName:e,targetUrl:n}},i.prototype.createShareInfo=function(t,e,n,i){return{icon:icon,menuName:mname,targetUrl:url}},i.prototype.createNavInfo=function(t,e,n,i,s,r,o,a){return{icon:t,iconCheck:s,url:n,tabName:e,tabTextColor:i,tabTextSelectColor:r,click:o,data:a}},i.prototype.errorLog=function(t,e,n){console.error(this.packLog(4,t,e,n))},i.prototype.packLog=function(t,e,n,i){return"["+t+"]"+e+"."+n+":"+(i instanceof String?i:JSON.stringify(i))},i.prototype.contractCall=function(t,e,n,i,s){var r="__onContractRes__"+this.getReqIndex();null!=i?this.setCallBack(r,i,s):this.setCallBack(r,this.onNullCallBack,this);var o={contractAddr:t,abi:JSON.stringify(e),args:n,callBack:r};try{return this.provider.contractCall(o)}catch(t){this.errorLog("CfxWeb3","contractCall",{paras:o,errMsg:t.message})}},i.prototype.getReqIndex=function(){return null!=i._reqIndex&&null!=i._reqIndex||(i._reqIndex=0),i._reqIndex++},i.prototype.accountCall=function(t,e,n,i,s,r,o,a){null!=o?this.setCallBack("__onAccountRes__",o,a):this.setCallBack("__onAccountRes__",this.onNullCallBack,this);var c={contractAddr:t,abi:JSON.stringify(e),args:n,address:i,callBack:"__onAccountRes__",appKey:s,callTip:r};try{return this.provider.accountCall(c)}catch(t){this.errorLog("CfxWeb3","accountCall",{paras:c,errMsg:t.message})}},i.prototype.getTransactionByHash=function(t,e,n,i){null!=n?this.setCallBack("__onTransactionRes__",n,i):this.setCallBack("__onTransactionRes__",this.onNullCallBack,this);var s={txhash:t,intervalMillis:e,callBack:"__onTransactionRes__"};return this.provider.getTransactionByHash(s)},i.prototype.depolyContract=function(t,e,n,i,s,r){null!=s?this.setCallBack("__onDepolyContractRes__",s,r):this.setCallBack("__onDepolyContractRes__",this.onNullCallBack,this);var o={address:t,abi:e,args:n,bytecode:i,callBack:"__onDepolyContractRes__"};this.provider.deployContract(o)},i.prototype.signData=function(t,e,n,i,s,r,o,a){null!=o?this.setCallBack("__onSignedData__",o,a):this.setCallBack("__onSignedData__",this.onNullCallBack,this);var c={raw:t,type:e,needHash:n,prefix:i,address:r,tip:s,callBack:"__onSignedData__"};this.provider.signData(c)},i.prototype.toShareInfo=function(t){return this.provider.toShare(t)},i.prototype.showScan=function(t,e){return null!=t?this.setCallBack("__onScanRes__",t,e):this.setCallBack("__onScanRes__",this.onNullCallBack,this),this.provider.showScan({callBack:"__onScanRes__"})},i.prototype.setRealName=function(t){return this.provider.setRealName({realNameToken:t})},i.prototype.requestWalletInfo=function(t,e,n,i){null!=n?this.setCallBack("__onWalletInfoRes__",n,i):this.setCallBack("__onWalletInfoRes__",this.onNullCallBack,this);var s={chainCode:t,needRealNameAuth:0,refresh:e,callBack:"__onWalletInfoRes__"};try{return this.provider.requestWalletInfo(s)}catch(t){this.errorLog("CfxWeb3","requestWalletInfo",{paras:s,errMsg:t.message})}},i.prototype.initDapp=function(t,e,n,i){var s={appName:t,appIcon:e,appUrl:n,appKey:i};return this.provider.initDapp(s)},i.prototype.exitDapp=function(){return this.provider.exitDapp({})},i.prototype.requestRealName=function(t,e){null!=t?this.setCallBack("__onRequestRealNameRes__",t,e):this.setCallBack("__onRequestRealNameRes__",this.onNullCallBack,this);var n={callBack:"__onRequestRealNameRes__"};try{return this.provider.requestRealName(n)}catch(t){this.errorLog("CfxWeb3","requestRealName",{paras:n,errMsg:t.message})}},i.stringToHexString=function(t){for(var e="",n=0;n<t.length;n++)e+="%"+t.charCodeAt(n).toString(16);return e},i.hexStringToString=function(t){for(var e=t.split("%"),n="",i=1;i<e.length;i++)n+=String.fromCharCode(parseInt(e[i],16));return n},i.bytesToHexString=function(t){for(var e="",n=0;n<t.length;n++){var i=(255&t[n]).toString(16);i.length<2&&(i="0"+i),e+=i}return"0x"+e},i.hexStringToBytes=function(t){if(0==(e=t.length))return[];e>2&&"0x"==t.substr(0,2)&&(t=t.substr(2));var e,n=[];(e=t.length)%2!=0&&(t="0"+t,e++);for(var i=0;i<e;i+=2){var s=t.substr(i,2);n.push(parseInt(s,16))}return n},i.prototype.getLoginToken=function(t){return this.setCallBack("__onLoginToken__",t),this.provider.getLoginToken("__onLoginToken__")},i.prototype.setLoginToken=function(t,e){return this.provider.setLoginToken({token:t,refreshToken:e})},i.prototype.requestToNewWeb=function(t,e){return this.provider.requestToNewWeb({url:t,model:e})},i.prototype.transferNft=function(t,e,n){this.setCallBack("_transferNftCallBack_",e,n);var i={tokenId:t.tokenId,nftName:t.nftName,contractAddr:t.contractAddr,address:t.address,callBack:"_transferNftCallBack_",chainCode:t.chainCode,tokenType:t.tokenType,amount:t.amount||1};try{return this.provider.transferNft(i)}catch(t){this.errorLog("CfxWeb3","transferNft",{paras:i,errMsg:t.message})}},i.prototype.launchWXMiniPay=function(t){var e={path:t.path,miniprogramType:t.miniprogramType};return this.provider.launchWXMiniPay(e)},i.prototype.unifiedFail=function(t,e){t.fail&&t.fail(e),t.complete&&t.complete(e)},i.prototype.unifiedSuccess=function(t,e){t.success&&t.success(e),t.complete&&t.complete(e)},i.prototype.unifiedCallBack=function(t,e){window[t]=t=>{this.unifiedSuccess(e,t)}},i.prototype.getUserAuthorizeInfo=function(t){window._requestUserAuthorizeInfo=e=>{try{0==e.code&&(this._userInfo=e.data,this.logoSrc="data:image/jpeg;base64,"+e.data.userImageFileBase64),this.unifiedSuccess(t,e)}catch(e){this.unifiedFail(t,e)}};let e={chainCode:t.chainCode,needRealNameAuth:t.realAuth,needLoginAuth:t.loginAuth,refresh:t.refresh,callBack:"_requestUserAuthorizeInfo"};try{return this.provider.requestUserInfo(e)}catch(e){this.unifiedFail(t,e)}},i.prototype.getWalletInfo=function(t){var e={chainCode:t.chainCode,needRealNameAuth:0,refresh:t.refresh,callBack:"__onWalletInfoRes__"};this.unifiedCallBack("__onWalletInfoRes__",t);try{return this.provider.requestWalletInfo(e)}catch(e){this.unifiedFail(t,e)}},i.prototype.getSignData=function(t){var e={raw:t.raw,type:t.type,needHash:t.needHash,prefix:t.prefix,address:t.address,tip:t.raw,callBack:"__onSignedData__"};this.unifiedCallBack("__onSignedData__",t);try{this.provider.signData(e)}catch(e){this.unifiedFail(t,e)}},i.prototype.callContract=function(t,e,n,i,s){var r="__onContractRes__"+this.getReqIndex();null!=i?this.setCallBack(r,i,s):this.setCallBack(r,this.onNullCallBack,this);var o={contractAddr:t,abi:JSON.stringify(e),args:n,callBack:r};try{return this.provider.contractCall(o)}catch(t){this.errorLog("CfxWeb3","contractCall",{paras:o,errMsg:t.message})}},i.prototype.alert=function(t){this.alertInfo({...t})},i.prototype.confirm=function(t){this.unifiedCallBack("__onConfirm__",t),this.confirmInfo({...t,callBack:"__onConfirm__"})},i}));
